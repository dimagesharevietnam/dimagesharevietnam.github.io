<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Middlewares">

        <meta property="og:site_name" content="Dimage Share Vietnam"/>
        <meta property="og:title" content="Middlewares | Dimage Share Vietnam"/>
        <meta property="og:description" content="Middlewares"/>
        <meta property="og:url" content="https://my-jigsaw-docs.com/docs/middlewares"/>
        <meta property="og:image" content="/assets/img/logo.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="Dimage Share Vietnam">
        <meta name="twitter:card" content="summary_large_image">

        
        <title>Dimage Share Vietnam | Middlewares</title>

        <link rel="home" href="https://my-jigsaw-docs.com">
        <link rel="icon" href="/favicon_64.png">

        
                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=ffd27a57fd0c917f193d">

            </head>

    <body class="flex flex-col justify-between min-h-screen bg-gray-100 text-gray-800 leading-normal font-sans">
        <header class="flex items-center shadow bg-white border-b h-24 mb-8 py-4" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="Dimage Share Vietnam home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="/assets/img/logo.png" alt="Dimage Share Vietnam logo" />

                        <h1 class="text-lg md:text-2xl text-blue-900 font-semibold hover:text-blue-600 my-0 pr-4">Dimage Share Vietnam</h1>
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10">
                                    </div>
            </div>

                <button class="flex justify-center items-center bg-blue-500 border border-blue-500 h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </header>

        <main role="main" class="w-full flex-auto">
            <section class="container max-w-8xl mx-auto px-6 md:px-8 py-4">
    <div class="flex flex-col lg:flex-row">
        <nav id="js-nav-menu" class="nav-menu hidden lg:block">
            <ul class="my-0 list-none list-inside pr-8">
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-600">Cài đặt Laravel</p>
    
            
        <ul class="my-0 list-none list-inside pr-8">
            <li class="pl-4">
            
        <a href="/docs/xampp-installation"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            1.1, XAMPP
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            1.2, Vagrant / Homestead
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            1.3, Docker
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-600">Kiến trúc cơ bản</p>
    
            
        <ul class="my-0 list-none list-inside pr-8">
            <li class="pl-4">
            
        <a href="/docs/request-lifecycle"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            2.1, Request lifecycle
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            2.2, Service Provider
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-600">Basic Laravel</p>
    
            
        <ul class="my-0 list-none list-inside pr-8">
            <li class="pl-4">
            
        <a href="/docs/routing"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.1, Routing
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/middlewares"
            class="lvl1  active font-semibold text-blue-500 nav-menu__item hover:text-blue-500"
        >
            3.2, Middlewares
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/controllers"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.3, Controllers
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.4, Requests
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.5, Responses
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.6, Views
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.7, Services
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.8, Eloquent Models
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.9, Events &amp; Handlers
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            3.10, Console
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-600">Laravel 6.0 LTS</p>
    
            
        <ul class="my-0 list-none list-inside pr-8">
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            4.1, Các điểm cần lưu ý của bản phát hành 6.0
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-600">Official Packages</p>
    
            
        <ul class="my-0 list-none list-inside pr-8">
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            5.1, Horizon
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            5.1, Telescope
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-600">Lumen</p>
    
            
        <ul class="my-0 list-none list-inside pr-8">
            <li class="pl-4">
            
        <a href="/#"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            6.1, So sánh giữa Lumen và Laravel
        </a>
    
    </li>
    </ul>
    </li>
    </ul>
        </nav>

        <div class="DocSearch-content w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
            <h1>Middleware trong Laravel</h1>
<h2>Tổng quan</h2>
<ul>
<li>Giới thiệu</li>
<li>Cách đăng ký</li>
<li>Cách dùng</li>
</ul>
<h2>1, Giới thiệu</h2>
<p><code>Middleware</code> nói chung là 1 cơ chế  trung gian nằm giữa các request và response. Nó nhận các request, thi hành các mệnh lệnh tương ứng trên request đó. Sau khi hoàn thành nó response (trả về) hoặc chuyển kết quả ủy thác cho một Middleware khác trong hàng đợi.</p>
<p>Trong <strong>Laravel</strong>, Middleware cung cấp một giải pháp khá tiện ích cho việc lọc các HTTP requests vào ứng dụng của chúng ta.
Ví dụ, với bản Laravel mặc định, ta có thể được cung cấp middleware liên quan đến xác thực người dùng. Nếu người dùng chưa được xác thực, Laravel sẽ chuyển hướng người dùng đến trang đăng nhập và ngược lại</p>
<p>Trong cách viết bình thường của Middleware chúng ta sẽ thấy có $request và $next được truyền vào trong function handle. Bên cạnh đó ta hoàn toàn có thể truyền thêm biến.</p>
<p>Ta cũng có thể thực hiện các lệnh trước hoặc sau $next để đảm bảo được mục đích</p>
<pre><code class="language-php">public function handle($request, Closure $next)
{

    //do something first
    $returnValue = $next($request);
    //do something later

    return $returnValue;
}</code></pre>
<h2>2, Cách đăng ký</h2>
<p>Ta có thể gõ lệnh</p>
<pre><code class="language-bash">php artisan make:middleware</code></pre>
<p>Hoặc đơn giản là thêm vào  trong thư mục <code>app/Http/Middleware</code></p>
<h2>3, Cách dùng</h2>
<p>Chúng ta chỉ nên dùng middleware cho 3 trường hợp sau:</p>
<h5>Dùng middleware global</h5>
<p>Chúng ta sẽ khai báo các middleware global trong <strong>app/Http/Kernel.php</strong></p>
<pre><code class="language-php">protected $routeMiddleware = [
    'auth' =&gt; \App\Http\Middleware\Authenticate::class,
    'auth.basic' =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
    'bindings' =&gt; \Illuminate\Routing\Middleware\SubstituteBindings::class,
    'cache.headers' =&gt; \Illuminate\Http\Middleware\SetCacheHeaders::class,
    'can' =&gt; \Illuminate\Auth\Middleware\Authorize::class,
    'guest' =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,
    'signed' =&gt; \Illuminate\Routing\Middleware\ValidateSignature::class,
    'throttle' =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,
    'verified' =&gt; \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,
];</code></pre>
<p>Các middleware được khai báo trên đây sẽ được dùng cho mọi nơi ở ứng dụng</p>
<h5>Dùng middleware cho các nhóm người dùng khác nhau</h5>
<p>Bằng việc tạo thêm các nhóm người dùng qua việc chia route và định nghĩa trong <strong>RouteServiceProvider</strong>, ta có thể chỉ định các nhóm người dùng nào sẽ được áp dụng các middleware nào. Chúng ta sẽ khai báo các middleware theo nhóm trong mảng <code>$middlewareGroups</code></p>
<p>Ví dụ</p>
<pre><code class="language-php"> protected $middlewareGroups = [
        'web' =&gt; [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            // \Illuminate\Session\Middleware\AuthenticateSession::class,
            \App\Http\Middleware\CheckForMaintenanceMode::class,
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],

        'admin' =&gt; [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            // \Illuminate\Session\Middleware\AuthenticateSession::class,
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ]
    ];</code></pre>
<h5>Dùng middleware cục bộ ngay trong các controller</h5>
<p>Để đảm bảo việc middleware chỉ cần được thực thi ở 1 số nơi nhất định như là trước mỗi controller. ta hoàn toàn có thể sử dụng tại <strong>function __contruct()</strong></p>
<p>Ví dụ</p>
<pre><code class="language-php">class Controller extends AppController
{
    /**
     * Use middlewares
     */
    public function __construct()
    {
        $this-&gt;middleware(['auth:admin']);
    }
}</code></pre>        </div>
    </div>
</section>
        </main>

        <script src="/assets/build/js/main.js?id=5dd822863934b75738db"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center">
                <li class="md:mr-2">
                    &copy; <a href="https://www.dimage.co.jp/vn/" title="Dimage Share Vietnam Website">Dimage Share Vietnam Co.,Ltd</a> 2019.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>
    </body>
</html>
